<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Prompt Terapi BebasNyeri</title>
<meta name="theme-color" content="#b30000">

<style>
body { font-family: Arial; background:#f5f5f5; padding:15px; }
h2 { color:#b30000; }
label { font-weight:bold; display:block; margin-top:10px; }
input, textarea, select {
    width:100%; padding:8px; margin-top:4px;
    border-radius:6px; border:1px solid #ccc;
}
button {
    margin-top:15px; padding:10px;
    background:#b30000; color:white;
    border:none; border-radius:6px;
    font-weight:bold; cursor:pointer;
}
textarea { min-height:90px; }
.result-box {
    background:white; padding:10px;
    margin-top:15px; border-radius:6px;
    white-space:pre-wrap;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h2>Form Konsultasi Terapi BebasNyeri</h2>

<label>Nama Pasien</label>
<input type="text" id="nama">

<label>Umur</label>
<input type="number" id="umur">

<label>Jenis Kelamin</label>
<select id="jk">
<option>Laki-laki</option>
<option>Perempuan</option>
</select>

<label>Sedang Hamil?</label>
<select id="hamil">
<option>Tidak</option>
<option>Ya</option>
</select>

<label>Jika Hamil, Berapa Bulan?</label>
<input type="text" id="bulanHamil">

<label>Riwayat Operasi</label>
<input type="text" id="operasi">

<label>Riwayat Penyakit</label>
<textarea id="penyakit"></textarea>

<label>Hasil Medis (HB, Tensi, Gula, dll)</label>
<textarea id="medis"></textarea>

<label>Keluhan Saat Ini</label>
<textarea id="keluhan"></textarea>

<button onclick="buatPrompt()">Buat Prompt AI + Copy</button>
<button onclick="downloadPDF()">Download PDF</button>

<div class="result-box" id="hasil"></div>

<script>
function buatPrompt(){
let prompt = `Anda adalah asisten AI klinik terapi BebasNyeri.

Berikan saran TERAPI pendamping serta pantangan makan/minum.

Data Pasien:
Nama: ${nama.value}
Umur: ${umur.value}
Jenis Kelamin: ${jk.value}
Sedang Hamil: ${hamil.value}
Bulan Kehamilan: ${bulanHamil.value}
Riwayat Operasi: ${operasi.value}
Riwayat Penyakit: ${penyakit.value}
Hasil Medis: ${medis.value}
Keluhan: ${keluhan.value}

Berikan jawaban dengan format:
1. Ringkasan kondisi
2. Saran terapi pendamping (BUKAN diagnosis medis)
3. Makanan/minuman yang disarankan
4. Makanan/minuman yang harus dihindari
5. Catatan keselamatan terapi`;

hasil.textContent = prompt;

copyToClipboard(prompt);
alert("Prompt berhasil dibuat & disalin otomatis!");
}

function copyToClipboard(text) {
if (navigator.clipboard) {
    navigator.clipboard.writeText(text);
} else {
    let textarea = document.createElement("textarea");
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);
}
}

function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const today = new Date();
    const tanggal = today.toLocaleDateString("id-ID");

    const noPasien = "BN-" + today.getFullYear().toString().slice(-2) +
                     (today.getMonth()+1).toString().padStart(2,'0') +
                     today.getDate().toString().padStart(2,'0') + "-" +
                     today.getHours().toString().padStart(2,'0') +
                     today.getMinutes().toString().padStart(2,'0');

    // Header teks
    doc.setFontSize(14);
    doc.text("LEMBAR KONSULTASI TERAPI", 105, 15, null, null, "center");
    doc.setFontSize(10);
    doc.text("BebasNyeri.com", 105, 22, null, null, "center");
    doc.text("Terapis: Bpk. Abu Khoir, S.Pd., M.Kom.", 105, 28, null, null, "center");
    doc.line(10, 32, 200, 32);

    doc.text("Tanggal: " + tanggal, 10, 38);
    doc.text("No. Rekam Pasien: " + noPasien, 140, 38);

    let text = hasil.textContent || "Prompt belum dibuat.";
    let lines = doc.splitTextToSize(text, 180);
    doc.text(lines, 10, 45);

    doc.save("Konsultasi_BebasNyeri_" + noPasien + ".pdf");
}

/* PWA */
if ('serviceWorker' in navigator) {
  const swCode = `
    self.addEventListener('install', e => self.skipWaiting());
    self.addEventListener('fetch', e => {});
  `;
  const blob = new Blob([swCode], { type: 'text/javascript' });
  const swURL = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swURL);
}
</script>

</body>
</html>
